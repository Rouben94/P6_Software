{% extends 'p2p/base_p2p.html' %}
{% block content %}

<meta http-equiv="refresh" content="1">

<h2>Bar Chart</h2>
  <p>Bar chart of the nodes and the channels</p>

  {% for node in nodes %}
  <h4>Node MAC Address: {{ node.mac }}</h4>
  <div id={{ node.mac }}></div>
    <script type="text/javascript">
      var mac = '{{ node.mac }}'
      var xValue = [];
      var yValue = [];

      {% for channel in node.channel_set.all %}
        xValue.push('Channel ' + '{{ channel.ch }}');
        yValue.push(parseInt('{{ channel.signal_to_noise_ratio }}', 10));
      {% endfor %}
      
      var trace1 = {
        x: xValue,
        y: yValue,
        name: "Node 1",
        type: 'bar',
        text: yValue.map(String),
        textposition: 'auto',
        hoverinfo: 'none',
        opacity: 0.75,
      };
      
      var data = [trace1]; 
      
      var layout = {
        xaxis: {
          title: ('MAC[' + '{{ node.mac }}' + ']'),
          titlefont: {
            size: 16,
            color: 'rgb(107, 107, 107)'
          }, barmode: 'group'
        },
        yaxis: {
          title: 'Packet loss [%]',
          titlefont: {
            size: 16,
            color: 'rgb(107, 107, 107)'
          }, barmode: 'group'
        }
      };
      
      Plotly.newPlot(mac, data, layout);
    </script>
  {% endfor %}

{% endblock %}